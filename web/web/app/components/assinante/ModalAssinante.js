/* Assinante´s Search Page generated by JSetup v0.95 :  at 23 de jun de 2021 23:11:05  */
import React from "react"

import { FormGroup, ControlLabel, FormControl, HelpBlock, Modal } from "react-bootstrap";
import JSPagination from "../core/JSTablePagination"
import DatatableConfig from "../core/DatatableConfig"
import HttpRequest from "../core/HttpRequest"
import JSInputField from "../core/JSInputField"

export default class ModalAssinante extends React.Component {
    static defaultProps = {
        value: {
            telefone: "",
            desconto: "",
            dataVencimento: "",
            cpf: "",
            nome: "",
            valorMensalidade: "",
            observacao: "",
            ativo: "",
            foto: "",
            celular: "",
            rg: "",
            dataHoraAssinatura: "",
            dataNascimento: "",
        },
        displayValue: "name",
        idValue: "id"
    }
    constructor(props) {
        super(props)
        this.service = new HttpRequest("/rs/crud/assinantes");
        this.state = {
            datatableConfig: new DatatableConfig(5),
            showModal: false
        }
    }
    componentDidMount = () => {
        this.paginate();
    }

    onSelect = (assinante) => {
        console.log(assinante)
        this.props.onChange(assinante);
        this.closeModal();
    }

    closeModal = () => {
        this.setState({ showModal: false });
    }

    openModal = () => {
        this.setState({ showModal: true });
    }

    reset = () => {
    }

    // será que é necessário usar o state??
    changePageSize = (event) => {
        const target = event.target;
        const theDatatableConfig = Object.assign(new DatatableConfig(), this.state.datatableConfig)
        theDatatableConfig.pageSize = parseInt(target.value, 10);
        theDatatableConfig.page = 1;

        this.setState({ datatableConfig: theDatatableConfig }, this.paginate);
    }


    paginate = (pageIndex = 1) => {
        const stateConf = this.state.datatableConfig;
        const datatableConfig = Object.assign(new DatatableConfig(), this.state.datatableConfig)
        datatableConfig.page = pageIndex;
        datatableConfig.loading = true;

        this.setState({ datatableConfig });

        this.service.getPage(
            datatableConfig,
            data => {
                datatableConfig.loading = false;
                datatableConfig.totalRecords = data.totalRecords;
                this.setState({ datatableConfig });
            },

            error => {
                console.error("error fetching assinante´s page", error);
            }
        );
    }

    changeSearchFormHandle = (event) => {
        /* Jogar essa atualização do state para fora, COMO?? */
        const target = event.target;
        const value = target.type === 'checkbox' ? target.checked : target.value;
        const name = target.name;

        const datatableConfig = { ...this.state.datatableConfig };
        datatableConfig.filterParameters[name] = value;

        this.setState({ datatableConfig });
    }

    render = () => {
        return (
            <div >
                <div className="input-group mar-btm">
                    <input type="text" className="form-control" value={this.props.value && this.props.value[this.props.displayValue]} placeholder="Nome" />
                    <span className="input-group-addon" onClick={this.openModal}>
                        <i className="fa fa-search" />
                    </span>
                </div>

                <Modal show={this.state.showModal} onHide={this.closeModal} bsSize="large" >
                    <Modal.Header closeButton>
                        <Modal.Title>Pesquisa de Assinante</Modal.Title>
                    </Modal.Header>
                    <Modal.Body>
                        <div className="">
                            <FormGroup controlId="controlIdTelefone"  >
                                <ControlLabel>Telefone</ControlLabel>
                                <JSInputField name="telefone" type="text" value={this.state.datatableConfig.filterParameters.telefone}  onChange={this.changeFormHandle} className="form-control" />
                            </FormGroup>
                            <FormGroup controlId="controlIdDesconto"  >
                                <ControlLabel>Desconto</ControlLabel>
                                <JSInputField name="desconto" plugin="decimal" type="text" value={this.state.datatableConfig.filterParameters.desconto}  onChange={this.changeFormHandle} className="form-control" />
                            </FormGroup>
                            <FormGroup controlId="controlIdDataVencimento"  >
                                <ControlLabel>Data vencimento</ControlLabel>
                                <JSInputField name="dataVencimento" plugin="date" type="text" value={this.state.datatableConfig.filterParameters.dataVencimento}  onChange={this.changeFormHandle} className="form-control" />
                            </FormGroup>
                            <FormGroup controlId="controlIdCpf"  >
                                <ControlLabel>Cpf</ControlLabel>
                                <JSInputField name="cpf" type="text" value={this.state.datatableConfig.filterParameters.cpf}  onChange={this.changeFormHandle} className="form-control" />
                            </FormGroup>
                            <FormGroup controlId="controlIdNome"  >
                                <ControlLabel>Nome</ControlLabel>
                                <JSInputField name="nome" type="text" value={this.state.datatableConfig.filterParameters.nome}  onChange={this.changeFormHandle} className="form-control" />
                            </FormGroup>
                            <FormGroup controlId="controlIdValorMensalidade"  >
                                <ControlLabel>Valor mensalidade</ControlLabel>
                                <JSInputField name="valorMensalidade" plugin="decimal" type="text" value={this.state.datatableConfig.filterParameters.valorMensalidade}  onChange={this.changeFormHandle} className="form-control" />
                            </FormGroup>
                            <FormGroup controlId="controlIdObservacao"  >
                                <ControlLabel>Observação</ControlLabel>
                                <JSInputField name="observacao" type="text" value={this.state.datatableConfig.filterParameters.observacao}  onChange={this.changeFormHandle} className="form-control" />
                            </FormGroup>
                            <FormGroup controlId="controlIdAtivo"  >
                                <ControlLabel>Ativo</ControlLabel>
                                <JSInputField name="ativo" type="text" value={this.state.datatableConfig.filterParameters.ativo}  onChange={this.changeFormHandle} className="form-control" />
                            </FormGroup>
                            <FormGroup controlId="controlIdFoto"  >
                                <ControlLabel>Foto</ControlLabel>
                                <JSInputField name="foto" type="text" value={this.state.datatableConfig.filterParameters.foto}  onChange={this.changeFormHandle} className="form-control" />
                            </FormGroup>
                            <FormGroup controlId="controlIdCelular"  >
                                <ControlLabel>Celular</ControlLabel>
                                <JSInputField name="celular" type="text" value={this.state.datatableConfig.filterParameters.celular}  onChange={this.changeFormHandle} className="form-control" />
                            </FormGroup>
                            <FormGroup controlId="controlIdRg"  >
                                <ControlLabel>Rg</ControlLabel>
                                <JSInputField name="rg" type="text" value={this.state.datatableConfig.filterParameters.rg}  onChange={this.changeFormHandle} className="form-control" />
                            </FormGroup>
                            <FormGroup controlId="controlIdDataHoraAssinatura"  >
                                <ControlLabel>Data hora assinatura</ControlLabel>
                                <JSInputField name="dataHoraAssinatura" plugin="datetime" type="text" value={this.state.datatableConfig.filterParameters.dataHoraAssinatura}  onChange={this.changeFormHandle} className="form-control" />
                            </FormGroup>
                            <FormGroup controlId="controlIdDataNascimento"  >
                                <ControlLabel>Data de Nascimento</ControlLabel>
                                <JSInputField name="dataNascimento" plugin="date" type="text" value={this.state.datatableConfig.filterParameters.dataNascimento}  onChange={this.changeFormHandle} className="form-control" />
                            </FormGroup>
                            <div className="form-actions ">
                                <button type="button" onClick={(event) => this.paginate()} className=" btn btn-primary btn-large" >
                                    <i className="fa fa-search" />
                                    &nbsp;Pesquisar
						        </button>
                                <button type="button" id="btnClear" className="btnClearSupplier btn btn-info btn-large">
                                    <i className="fa fa-trash" />
                                    &nbsp;Nova Pesquisa
						        </button>
                            </div>

                            <div className="">
                                <div className="cente">
                                    <h3 className="header smaller lighter blue">Resultados</h3>
                                    <div className="table-responsive ">
                                        <table className="demo-add-niftycheck table table-hover">
                                            <thead>
                                                <tr>
		                                            <th className="th-telefone">
		                                                <a >
		                                                    <i className="fa " />
		                                                    telefone
		                                                </a>
		                                            </th>
		                                            <th className="th-desconto">
		                                                <a >
		                                                    <i className="fa " />
		                                                    desconto
		                                                </a>
		                                            </th>
		                                            <th className="th-dataVencimento">
		                                                <a >
		                                                    <i className="fa " />
		                                                    data vencimento
		                                                </a>
		                                            </th>
		                                            <th className="th-cpf">
		                                                <a >
		                                                    <i className="fa " />
		                                                    cpf
		                                                </a>
		                                            </th>
		                                            <th className="th-nome">
		                                                <a >
		                                                    <i className="fa " />
		                                                    nome
		                                                </a>
		                                            </th>
		                                            <th className="th-valorMensalidade">
		                                                <a >
		                                                    <i className="fa " />
		                                                    valor mensalidade
		                                                </a>
		                                            </th>
		                                            <th className="th-observacao">
		                                                <a >
		                                                    <i className="fa " />
		                                                    observação
		                                                </a>
		                                            </th>
		                                            <th className="th-ativo">
		                                                <a >
		                                                    <i className="fa " />
		                                                    ativo
		                                                </a>
		                                            </th>
		                                            <th className="th-foto">
		                                                <a >
		                                                    <i className="fa " />
		                                                    foto
		                                                </a>
		                                            </th>
		                                            <th className="th-celular">
		                                                <a >
		                                                    <i className="fa " />
		                                                    celular
		                                                </a>
		                                            </th>
		                                            <th className="th-rg">
		                                                <a >
		                                                    <i className="fa " />
		                                                    rg
		                                                </a>
		                                            </th>
		                                            <th className="th-dataHoraAssinatura">
		                                                <a >
		                                                    <i className="fa " />
		                                                    data hora assinatura
		                                                </a>
		                                            </th>
		                                            <th className="th-dataNascimento">
		                                                <a >
		                                                    <i className="fa " />
		                                                    data de Nascimento
		                                                </a>
		                                            </th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {
                                                    this.state.datatableConfig.items.map((assinante, index) => {
                                                        return (
                                                    <tr key={assinante.id}>
                                                        <td>{assinante.telefone}</td>
                                                        <td>{assinante.desconto}</td>
                                                        <td>{assinante.dataVencimento}</td>
                                                        <td>{assinante.cpf}</td>
                                                        <td>{assinante.nome}</td>
                                                        <td>{assinante.valorMensalidade}</td>
                                                        <td>{assinante.observacao}</td>
                                                        <td>{assinante.ativo}</td>
                                                        <td>{assinante.foto}</td>
                                                        <td>{assinante.celular}</td>
                                                        <td>{assinante.rg}</td>
                                                        <td>{assinante.dataHoraAssinatura}</td>
                                                        <td>{assinante.dataNascimento}</td>
                                                    </tr>)
                                                    })
                                                }
                                                {this.state.datatableConfig.items.length === 0 ?
                                                    <tr className="empty"><td colSpan="2">Sem registros</td></tr> : null
                                                }
                                            </tbody>
                                        </table>
                                    </div>
                                    <div className="row page-footer-components fixed-table-pagination">
                                        <div className="col-md-6" >
                                            <div className=" float-left ">
                                                {this.state.datatableConfig.loading ?
                                                    <span className="loading-elements">
                                                        <span className="">
                                                            <i className="fa fa-spinner fa-spin fa-fw" />
                                                            Carregando...
								                        </span>
                                                    </span>
                                                    :
                                                    <span className="has-elements" >
                                                        Registros
								                        <span className="initial-page">&nbsp;{this.state.datatableConfig.first}&nbsp;</span>
                                                        a
								                        <span className="final-page">&nbsp;{this.state.datatableConfig.last}&nbsp;</span>
                                                        de
								                        <span className="total-records">&nbsp;{this.state.datatableConfig.totalRecords}</span>
                                                        . Exibindo até
								                        <select className="combo-page-size" onChange={this.changePageSize} value={this.state.datatableConfig.pageSize}>
                                                            <option value="3">3</option>
                                                            <option value="5">5</option>
                                                            <option value="10" >10</option>
                                                            <option value="25">25</option>
                                                            <option value="50">50</option>
                                                        </select>
                                                        por página.
							                        </span>
                                                }
                                            </div>
                                        </div>
                                        <div className="col-md-6" >
                                            <div className="pull-right" >
                                                <JSPagination onPaginate={this.paginate} totalItems={this.state.datatableConfig.totalRecords} page={this.state.datatableConfig.page} pageSize={this.state.datatableConfig.pageSize} />
                                            </div>
                                        </div >
                                    </div >
                                </div >
                            </div >
                        </div >
                    </Modal.Body>
                </Modal>
            </div >
        );
    }
}
